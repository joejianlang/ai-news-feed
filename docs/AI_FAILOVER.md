# AI æ•…éšœè½¬ç§»ç³»ç»Ÿæ–‡æ¡£

## ğŸ›¡ï¸ åŠŸèƒ½æ¦‚è¿°

AI æ•…éšœè½¬ç§»ç³»ç»Ÿæä¾›ï¼š
1. **è‡ªåŠ¨åˆ‡æ¢**ï¼šä¸» AI å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨ AI
2. **æ™ºèƒ½å‘Šè­¦**ï¼šè¶…è¿‡å¤±è´¥é˜ˆå€¼åå‘é€å‘Šè­¦
3. **é™çº§æœåŠ¡**ï¼šä¸¤ä¸ª AI éƒ½å¤±è´¥æ—¶æä¾›é™çº§å“åº”
4. **å¥åº·ç›‘æ§**ï¼šå®æ—¶ç›‘æ§ AI æœåŠ¡å¥åº·çŠ¶æ€

## ğŸ“Š å·¥ä½œæµç¨‹

```
ç”¨æˆ·è¯·æ±‚
    â†“
å°è¯•ä¸» AI (Gemini/Claude)
    â†“
æˆåŠŸ? â”€â”€â”€â”€â”
    â†“     â”‚
   å¤±è´¥   æˆåŠŸ
    â†“     â”‚
è®°å½•å¤±è´¥  â”‚
    â†“     â”‚
å°è¯•å¤‡ç”¨ AI
    â†“     â”‚
æˆåŠŸ? â”€â”€â”€â”€â”¤
    â†“     â”‚
   å¤±è´¥   â”‚
    â†“     â”‚
é™çº§å“åº”  â”‚
    â†“     â”‚
    â””â”€â”€â”€â”€â”€â”˜
    â†“
è¿”å›ç»“æœ
```

## âš™ï¸ é…ç½®è¯´æ˜

### æ•…éšœé˜ˆå€¼

```typescript
MAX_FAILURES = 3  // è¶…è¿‡ 3 æ¬¡å¤±è´¥å‘é€å‘Šè­¦
```

### å‘Šè­¦å†·å´æ—¶é—´

```typescript
ALERT_COOLDOWN = 30 * 60 * 1000  // 30 åˆ†é’Ÿ
```

é˜²æ­¢çŸ­æ—¶é—´å†…é‡å¤å‘Šè­¦ã€‚

## ğŸš¨ å‘Šè­¦æœºåˆ¶

### è§¦å‘æ¡ä»¶

- è¿ç»­å¤±è´¥æ¬¡æ•° â‰¥ 3 æ¬¡
- è·ç¦»ä¸Šæ¬¡å‘Šè­¦ > 30 åˆ†é’Ÿ

### å‘Šè­¦å†…å®¹

```
âš ï¸âš ï¸âš ï¸ AI æœåŠ¡å‘Šè­¦ âš ï¸âš ï¸âš ï¸
æä¾›å•†: GEMINI
é”™è¯¯ä¿¡æ¯: API rate limit exceeded
å¤±è´¥æ¬¡æ•°: 3/3
æ—¶é—´: 2026-02-05T03:30:00.000Z
å»ºè®®: è¯·æ£€æŸ¥ API å¯†é’¥å’Œé…é¢é™åˆ¶
```

### å‘Šè­¦æ¸ é“ï¼ˆå¯æ‰©å±•ï¼‰

å½“å‰ï¼š
- âœ… æ§åˆ¶å°æ—¥å¿—

å¾…æ‰©å±•ï¼š
- ğŸ“§ é‚®ä»¶é€šçŸ¥
- ğŸ’¬ é’‰é’‰/ä¼ä¸šå¾®ä¿¡
- ğŸ“± Slack/Discord
- ğŸ“ æ—¥å¿—æ–‡ä»¶

## ğŸ“ˆ å¥åº·çŠ¶æ€ç›‘æ§

### API ç«¯ç‚¹

**GET** `/api/admin/ai-health`

è¿”å›ï¼š
```json
{
  "timestamp": "2026-02-05T03:30:00.000Z",
  "services": {
    "gemini": {
      "failures": 0,
      "status": "healthy"
    },
    "claude": {
      "failures": 0,
      "status": "healthy"
    }
  }
}
```

### å‰ç«¯æ˜¾ç¤º

ç®¡ç†åå°ä¼šæ˜¾ç¤ºï¼š
```
ğŸ¤– AI æœåŠ¡çŠ¶æ€
Gemini: âœ… æ­£å¸¸    Claude: âœ… æ­£å¸¸
```

## ğŸ”„ æ•…éšœæ¢å¤

### è‡ªåŠ¨æ¢å¤

å½“å¤±è´¥çš„ AI å†æ¬¡æˆåŠŸæ—¶ï¼Œè‡ªåŠ¨é‡ç½®å¤±è´¥è®¡æ•°ï¼š

```typescript
// ä¸» AI æ¢å¤
if (failureCount[primaryProvider] > 0) {
  console.log('Gemini æ¢å¤æ­£å¸¸ï¼Œé‡ç½®å¤±è´¥è®¡æ•°');
  failureCount.gemini = 0;
}
```

### æ‰‹åŠ¨é‡ç½®

**POST** `/api/admin/ai-health`

é‡ç½®æ‰€æœ‰ï¼š
```json
{}
```

é‡ç½®ç‰¹å®š AIï¼š
```json
{
  "provider": "gemini"
}
```

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ 1ï¼šGemini è¶…é™ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ° Claude

```
[Failover] ä½¿ç”¨ä¸» AI: gemini
[Failover] âŒ gemini å¤±è´¥ (1/3)
[Failover] é”™è¯¯: API rate limit exceeded
[Failover] ğŸ”„ åˆ‡æ¢åˆ°å¤‡ç”¨ AI: claude
[Failover] âœ… claude æˆåŠŸ
```

### åœºæ™¯ 2ï¼šè¿ç»­å¤±è´¥è§¦å‘å‘Šè­¦

```
[Failover] âŒ gemini å¤±è´¥ (3/3)
âš ï¸âš ï¸âš ï¸ AI æœåŠ¡å‘Šè­¦ âš ï¸âš ï¸âš ï¸
æä¾›å•†: GEMINI
å¤±è´¥æ¬¡æ•°: 3/3
```

### åœºæ™¯ 3ï¼šä¸¤ä¸ª AI éƒ½å¤±è´¥ï¼Œé™çº§å“åº”

```
[Failover] âŒ gemini å¤±è´¥ (3/3)
[Failover] âŒ claude ä¹Ÿå¤±è´¥äº† (3/3)
[Failover] âš ï¸ æ‰€æœ‰ AI æœåŠ¡éƒ½å¤±è´¥ï¼Œè¿”å›é™çº§å“åº”
```

è¿”å›ï¼š
```json
{
  "summary": "ï¼ˆAI æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼‰æ–°é—»å†…å®¹æ‘˜è¦...",
  "commentary": "ï¼ˆAI è¯„è®ºæœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•ï¼‰",
  "translatedTitle": "åŸæ ‡é¢˜"
}
```

## ğŸ”§ æ‰©å±•å‘Šè­¦æ¸ é“

### æ·»åŠ é’‰é’‰é€šçŸ¥

åœ¨ `lib/ai/failover.ts` ä¸­ï¼š

```typescript
async function sendDingTalkAlert(data: {
  provider: string;
  error: Error;
  failureCount: number;
}) {
  const webhook = process.env.DINGTALK_WEBHOOK;
  if (!webhook) return;

  await fetch(webhook, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      msgtype: 'text',
      text: {
        content: `âš ï¸ AI æœåŠ¡å‘Šè­¦\næä¾›å•†: ${data.provider}\nå¤±è´¥æ¬¡æ•°: ${data.failureCount}\né”™è¯¯: ${data.error.message}`,
      },
    }),
  });
}
```

### æ·»åŠ é‚®ä»¶é€šçŸ¥

```typescript
async function sendEmailAlert(data: {
  provider: string;
  error: Error;
  failureCount: number;
}) {
  // ä½¿ç”¨ nodemailer æˆ–å…¶ä»–é‚®ä»¶æœåŠ¡
  // ...
}
```

## ğŸ“Š ç›‘æ§æœ€ä½³å®è·µ

1. **å®šæœŸæ£€æŸ¥å¥åº·çŠ¶æ€**
   - è®¿é—® `/sources` é¡µé¢æŸ¥çœ‹å®æ—¶çŠ¶æ€
   - æˆ–è°ƒç”¨ `/api/admin/ai-health` API

2. **è®¾ç½®å‘Šè­¦é€šçŸ¥**
   - é…ç½®é’‰é’‰/é‚®ä»¶ç­‰é€šçŸ¥æ¸ é“
   - ç¡®ä¿åŠæ—¶æ”¶åˆ°å‘Šè­¦

3. **åˆ†æå¤±è´¥åŸå› **
   - æ£€æŸ¥ API å¯†é’¥æ˜¯å¦æœ‰æ•ˆ
   - æ£€æŸ¥æ˜¯å¦è¶…å‡ºé…é¢é™åˆ¶
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

4. **æ‰‹åŠ¨é‡ç½®**
   - é—®é¢˜è§£å†³åæ‰‹åŠ¨é‡ç½®å¤±è´¥è®¡æ•°
   - é¿å…è¯¯å‘Šè­¦

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆéœ€è¦æ•…éšœè½¬ç§»ï¼Ÿ
A:
- AI API å¯èƒ½è¶…é™ã€ç½‘ç»œæ•…éšœã€æœåŠ¡ä¸­æ–­
- è‡ªåŠ¨åˆ‡æ¢ä¿è¯æœåŠ¡å¯ç”¨æ€§
- é™çº§å“åº”é¿å…å®Œå…¨å¤±è´¥

### Q: å¤‡ç”¨ AI æ˜¯å“ªä¸ªï¼Ÿ
A:
- ä¸» AI æ˜¯ Gemini â†’ å¤‡ç”¨æ˜¯ Claude
- ä¸» AI æ˜¯ Claude â†’ å¤‡ç”¨æ˜¯ Gemini

### Q: é™çº§å“åº”çš„å½±å“ï¼Ÿ
A:
- æ–°é—»ä»ä¼šè¢«ä¿å­˜
- åªæ˜¯æ²¡æœ‰ AI åˆ†æå’Œè¯„è®º
- å¯ä»¥åç»­é‡æ–°åˆ†æ

### Q: å¦‚ä½•é¿å…é¢‘ç¹åˆ‡æ¢ï¼Ÿ
A:
- åˆç†é…ç½® API é…é¢
- ä½¿ç”¨å…è´¹çš„ Gemini ä½œä¸ºä¸» AI
- ç›‘æ§ä½¿ç”¨é‡ï¼Œæå‰é¢„è­¦

## ğŸ¯ æ€»ç»“

æ•…éšœè½¬ç§»ç³»ç»Ÿç¡®ä¿ï¼š
- âœ… é«˜å¯ç”¨æ€§ï¼šä¸» AI å¤±è´¥è‡ªåŠ¨åˆ‡æ¢
- âœ… å¯è§‚æµ‹æ€§ï¼šå®æ—¶å¥åº·çŠ¶æ€ç›‘æ§
- âœ… å¯æ¢å¤æ€§ï¼šè‡ªåŠ¨å’Œæ‰‹åŠ¨æ¢å¤æœºåˆ¶
- âœ… é™çº§ä¿æŠ¤ï¼šæœ€åæƒ…å†µä¸‹ä»å¯ç”¨

**å»ºè®®é…ç½®ï¼š**
- ä¸» AIï¼šGemini 2.5 Flashï¼ˆå…è´¹ï¼‰
- å¤‡ç”¨ AIï¼šClaude Haikuï¼ˆä»˜è´¹ä½†ç¨³å®šï¼‰
- ç¡®ä¿ä¸¤ä¸ª AI éƒ½é…ç½®å¥½ API å¯†é’¥
